---
layout:     post
title:      2019-11-22-临时记事本
subtitle:   
date:       2019-11-12
author:     K
header-img: img/post-bg-desk.jpg
catalog: true
tags:
    - java
---
/*1 Vip TAb点击*/
select id,count(distinct omgid) tab_uv,count(1) 
  from omg_tdbank::mta_t_boss_v1_3491
    where substr(tdbank_imp_date, 1, 8)=20191122
    and ei='video_jce_home_tab_change'
    and get_json_object(kv,'$.newtab') ='4'
    and id='1100214736'
    and av='7.7.0.20401'
group by id

/*2 VIP 频道曝光*/
select ztid,id,count(distinct omgid) page_uv,count(1) vv  from    d_p2p_log::t_videoapp_tab_show_flow_h
where imp_datehour>=2019112200 and imp_datehour<=2019112223
and app_ver='7.7.0.20401'
and id ='1100214736'
and ztid in ('100137','100199','100200','100201','100202','100203','100204','120118','120126','120135','120145')
group by ztid,id

/*3 获取数据成功：合并网络请求数据回包和读取缓存*/
select count(distinct omgid) data_uv,count(1) from omg_tdbank::mta_t_boss_v1_8518 
where tdbank_imp_date>=2019112200 and tdbank_imp_date<=2019112223
and ei ='video_jce_poster_load'
and id ='1100214736'
and av='7.7.0.20401'
and  regexp_extract(get_json_object(kv,'$.reportParams'),'(^|&)mod_id=([^&]*)(&|$)',2) in ('11','14')

/*4 海报精选曝光 oper=1  --1曝光 2点击*/
select count(distinct omgid) poster_uv ,count(1) 
from hlw_tencentvideo::t_video_recommend_exposure_click_v2 
where imp_hour>=2019112200 and imp_hour<=2019112223
and av='7.7.0.20401'
and ztid='100137'
and id='1100214736'
and oper=1

/*5 新增事件*/
select count(distinct omgid) uv, count(1) pv, ei from omg_tdbank::mta_t_boss_v1_8518 
where tdbank_imp_date>=2019112200 and tdbank_imp_date<=2019112223
and ei in (
'VipReport_VipPagerFragment_onCreateView',
'VipReport_VipChannelFragment_onCreateView', 
'VipReport_VipChannelVnFragment_onCreateView',
'VipReport_Vn_showContent',
'VipReport_Vn_showContent_finish_visible',      
'VipReport_Vn_showContent_finish_invisible',
'VipReport_loadVNPageData',
'VipReport_VipFulishe_onFragmentVisible_2s',
'VipReport_VipFulishe_onFragmentVisible_5s',
'VipReport_VipMovie_onFragmentVisible_2s',      
'VipReport_VipMovie_onFragmentVisible_5s', 
'VipReport_VipTv_onFragmentVisible_2s',
'VipReport_VipTv_onFragmentVisible_5s',
'VipReport_destroyed_when_showContent_unfinish')
and id ='1100214736'
and av='7.7.0.20401'
group by ei